<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gakuen Empire Idle</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div id="left-menu">
    <div class="menu-header"><h1>Gakuen Empire</h1></div>

    <div class="menu-section">
        <div class="stat-row"><span class="label">Godzina:</span><span id="current-hour">08:00</span></div>
        <div class="stat-row"><span class="label">DzieÅ„:</span><span id="current-day">PoniedziaÅ‚ek</span></div>
        <div class="stat-row"><span class="label">Data:</span><span id="current-date">1 Kwi 2025</span></div>
    </div>

    <div class="menu-section">
        <div class="stat-row"><span class="label">GotÃ³wka:</span><span id="money">Â¥800,000</span></div>
        <div class="stat-row"><span class="label">DÅ‚ug:</span><span id="debt">Â¥5,000,000</span></div>
        <div class="stat-row"><span class="label">Reputacja:</span><span id="reputation">45</span></div>
        <div class="stat-row"><span class="label">Empatia:</span><span id="empathy">0 / 100</span></div>
        <div class="stat-row"><span class="label">Morale Å›rednie:</span><span id="morale">65%</span></div>
        <div class="stat-row"><span class="label">Dziewczyny:</span><span id="girl-count">0 / 6</span></div>
    </div>

    <div class="menu-section">
        <button class="nav-btn active" data-page="dashboard">ğŸ“Š Dashboard</button>
        <button class="nav-btn" data-page="girls">ğŸ‘§ Dziewczyny</button>
        <button class="nav-btn" data-page="events">ğŸ“° Wydarzenia</button>
        <button class="nav-btn" data-page="options">âš™ï¸ Opcje</button>
    </div>

    <div class="menu-section">
        <div style="display:flex; flex-wrap:wrap; gap:4px;">
            <button id="pause-btn" class="time-btn" style="flex:1 1 100%;">â–¶ Start</button>
            <button class="time-btn active" data-speed="1">1Ã—</button>
            <button class="time-btn" data-speed="5">5Ã—</button>
            <button class="time-btn" data-speed="10">10Ã—</button>
            <button class="time-btn" data-speed="30">30Ã—</button>
        </div>
    </div>

    <div class="menu-section">
        <button id="save-btn" class="action-btn">ğŸ’¾ Zapisz</button>
        <button id="load-btn" class="action-btn">ğŸ“‚ Wczytaj</button>
    </div>
</div>

<div id="main-content">
    <div id="page-dashboard" class="page active">
        <h2>Dashboard â€“ Seiran Academy</h2>
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>Status szkoÅ‚y</h3>
                <p>ZarzÄ…dzasz akademiÄ… z dÅ‚ugiem Â¥5,000,000.</p>
                <button class="action-btn" onclick="payDebt(100000)">SpÅ‚aÄ‡ Â¥100,000</button>
                <button class="action-btn" onclick="payDebt(500000)">SpÅ‚aÄ‡ Â¥500,000</button>
                <button class="action-btn" onclick="payDebt(gameState.money)">SpÅ‚aÄ‡ caÅ‚oÅ›Ä‡</button>
            </div>
            <div class="dashboard-card">
                <h3>Dzienny przychÃ³d</h3>
                <p id="daily-income" style="font-size:2.2em; font-weight:bold; color:var(--accent-secondary);">Â¥0</p>
                <p id="income-breakdown"></p>
            </div>
            <div class="dashboard-card">
                <h3>Aktywne dziewczyny</h3>
                <p id="active-girls" style="font-size:2.2em; font-weight:bold; color:var(--accent-primary);">0</p>
            </div>
        </div>
    </div>

    <div id="page-girls" class="page">
        <h2>Dziewczyny</h2>
        <div id="girls-list"></div>
    </div>

    <div id="page-events" class="page">
        <h2>Historia wydarzeÅ„</h2>
        <div id="events-log" class="event-log-container"></div>
    </div>

    <div id="page-options" class="page">
        <h2>Opcje</h2>
        <button id="reset-game" class="action-btn" style="background:var(--danger);">Reset gry</button>
    </div>
</div>

<div id="event-modal" class="modal">
    <div class="modal-content">
        <h3 id="event-title"></h3>
        <p id="event-description" style="white-space:pre-line;"></p>
        <div id="event-choices"></div>
    </div>
</div>

<script>
// ============================================================================
// DANE STAÅE
// ============================================================================

const JOBS = {
    none:          { name: "Wolne",           baseIncome: 0,    reqLewd: 0    },
    school_dates:  { name: "Randki szkolne",  baseIncome: 5000, reqLewd: 5    },
    hostess:       { name: "Hostessa",        baseIncome:15000, reqLewd:20    },
    delivery:      { name: "Delivery Health", baseIncome:30000, reqLewd:50    },
    soapland:      { name: "Soapland",        baseIncome:60000, reqLewd:70    },
};

const FIRST_NAMES = ["Aoi","Hana","Yui","Rin","Saki","Nao","Mio","Kanon","Rei","Mei","Yuna","Sakura","Haruka","Akari"];
const LAST_NAMES  = ["Tanaka","Suzuki","Yamada","Sato","Ito","Nakamura","Kobayashi","Yamamoto","Watanabe","Saito"];
const PERSONALITIES = ["NieÅ›miaÅ‚a","Pewna siebie","WesoÅ‚a","Cicha","Marzycielska","Buntownicza","Pracowita"];

const EVENT_DATE_RETURN = {
    id: "date_return",
    title: "PowrÃ³t z randki",
    chance: 5,          // mocno obniÅ¼one
    cooldown: 12,
    minJob: "school_dates"
};

const EVENT_RECRUIT = {
    id: "recruit",
    title: "Nowa uczennica",
    chance: 2.5,        // bardzo rzadko
    cooldown: 30,
    cost: 50000
};

// ============================================================================
// STAN GRY
// ============================================================================

let gameState = {
    time: { h:8, dayOfWeek:1, day:1, month:4, year:2025 },
    money: 800000,
    debt: 5000000,
    reputation: 45,
    empathy: 0,
    girls: [],
    maxGirls: 6,
    gameSpeed: 1,
    isPaused: true,
    eventCooldowns: {},
    lastEventCheck: 0,
    eventLog: []
};

const TICK_MS = 3000; // 3 s = 1 godzina przy prÄ™dkoÅ›ci 1Ã—
let gameInterval;

// ============================================================================
// INICJALIZACJA
// ============================================================================

function init() {
    addRandomGirl(); // start z jednÄ… dziewczynÄ…
    setupUI();
    startLoop();
    updateAll();
}

function setupUI() {
    document.querySelectorAll('.nav-btn').forEach(b => {
        b.addEventListener('click', () => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`page-${b.dataset.page}`).classList.add('active');
            b.classList.add('active');
            if (b.dataset.page === 'girls') renderGirls();
            if (b.dataset.page === 'events') renderLog();
        });
    });

    document.getElementById('pause-btn').onclick = () => {
        gameState.isPaused = !gameState.isPaused;
        document.getElementById('pause-btn').textContent = gameState.isPaused ? 'â–¶ Start' : 'â¸ Pauza';
    };

    document.querySelectorAll('[data-speed]').forEach(b => {
        b.onclick = () => {
            gameState.gameSpeed = Number(b.dataset.speed);
            document.querySelectorAll('[data-speed]').forEach(btn => btn.classList.remove('active'));
            b.classList.add('active');
            startLoop();
        };
    });

    document.getElementById('save-btn').onclick = saveGame;
    document.getElementById('load-btn').onclick = loadGame;
    document.getElementById('reset-game').onclick = () => {
        if (confirm("Na pewno zresetowaÄ‡ grÄ™?")) {
            localStorage.removeItem('gakuenSave');
            location.reload();
        }
    };
}

function startLoop() {
    clearInterval(gameInterval);
    gameInterval = setInterval(() => {
        if (!gameState.isPaused) tick();
    }, TICK_MS / gameState.gameSpeed);
}

// ============================================================================
// GÅÃ“WNA PÄ˜TLA
// ============================================================================

function tick() {
    gameState.time.h++;
    gameState.empathy = Math.min(100, gameState.empathy + 1);
    gameState.lastEventCheck++;

    if (gameState.time.h >= 24) {
        gameState.time.h = 0;
        gameState.time.dayOfWeek = gameState.time.dayOfWeek % 7 + 1;
        gameState.time.day++;
        dailyTick();
        if (gameState.time.day > 30) {
            gameState.time.day = 1;
            gameState.time.month++;
            if (gameState.time.month > 12) {
                gameState.time.month = 1;
                gameState.time.year++;
            }
        }
    }

    // Event co ~4â€“8 godzin Å›rednio
    if (gameState.lastEventCheck >= 4 && Math.random() < 0.09) {
        tryTriggerEvent();
        gameState.lastEventCheck = 0;
    }

    updateAll();
}

function dailyTick() {
    let totalIncome = 0;
    gameState.girls.forEach(g => {
        if (g.job !== 'none') {
            const inc = calculateIncome(g);
            totalIncome += inc;
            g.morale = Math.max(5, g.morale - 1.5);
        }
    });
    gameState.money += totalIncome;
    gameState.debt += Math.floor(gameState.debt * 0.0008);
}

// ============================================================================
// FUNKCJE MECHANIKI
// ============================================================================

function addRandomGirl() {
    if (gameState.girls.length >= gameState.maxGirls) return false;

    const fn = FIRST_NAMES[Math.floor(Math.random() * FIRST_NAMES.length)];
    const ln = LAST_NAMES[Math.floor(Math.random() * LAST_NAMES.length)];
    const pers = PERSONALITIES[Math.floor(Math.random() * PERSONALITIES.length)];

    const girl = {
        id: gameState.girls.length + 1,
        name: `${fn} ${ln}`,
        age: 16 + Math.floor(Math.random() * 4), // 16â€“19
        personality: pers,
        loyalty: 35 + Math.floor(Math.random() * 26),
        lewdness: 5 + Math.floor(Math.random() * 21),
        morale: 45 + Math.floor(Math.random() * 31),
        grades: 68 + Math.floor(Math.random() * 23),
        skills: {
            conversation: 5 + Math.floor(Math.random() * 46),
            handjob: 0,
            blowjob: 0,
            vaginal: 0,
            anal: 0,
            feet: 0
        },
        job: 'none'
    };

    gameState.girls.push(girl);
    log(`âœ¨ DoÅ‚Ä…czyÅ‚a: ${girl.name} (${girl.age} lat, ${pers})`);
    return true;
}

function calculateIncome(g) {
    const j = JOBS[g.job];
    if (!j) return 0;
    let inc = j.baseIncome;
    inc *= 1 + (g.lewdness / 180);
    inc *= 0.7 + (g.morale / 140);
    inc *= 0.8 + (g.loyalty / 250);
    return Math.floor(inc);
}

function canDoJob(g, jobKey) {
    const j = JOBS[jobKey];
    return j && g.lewdness >= j.reqLewd;
}

function trainLewd(gid) {
    if (gameState.money < 15000) return;
    gameState.money -= 15000;
    const g = gameState.girls.find(x => x.id === gid);
    g.lewdness = Math.min(100, g.lewdness + 7 + ~~(Math.random()*6));
    g.morale = Math.max(0, g.morale - 4);

    const sk = Object.keys(g.skills);
    const skill = sk[~~(Math.random()*sk.length)];
    g.skills[skill] = Math.min(100, (g.skills[skill]||0) + 4 + ~~(Math.random()*5));

    log(`ğŸ“š ${g.name} â†’ lewdness +${g.lewdness-lastLewd}, ${skill} wzrÃ³sÅ‚`);
    renderGirls();
}

function comfort(gid) {
    if (gameState.empathy < 50) return;
    gameState.empathy -= 50;
    const g = gameState.girls.find(x => x.id === gid);
    g.morale = Math.min(100, g.morale + 16);
    g.loyalty = Math.min(100, g.loyalty + 7);
    log(`â¤ï¸ PocieszyÅ‚eÅ› ${g.name} (-50 empatii)`);
    renderGirls();
}

function inviteHome(gid) {
    const g = gameState.girls.find(x => x.id === gid);
    let msg = "";

    if (g.lewdness < 25) {
        msg = `${g.name} przyszÅ‚a na herbatÄ™ i pogadaÄ‡.\nLojalnoÅ›Ä‡ +6`;
        g.loyalty += 6;
    } else if (g.lewdness < 55) {
        msg = `Lekkie pieszczoty i bliskoÅ›Ä‡â€¦\nLewdness +5, Morale +9`;
        g.lewdness += 5;
        g.morale += 9;
    } else {
        msg = `Bardzo intymny wieczÃ³râ€¦ ${g.name} jest wyczerpana, ale szczÄ™Å›liwa.\nLewdness +12, wszystkie umiejÄ™tnoÅ›ci +4â€“10`;
        g.lewdness += 12;
        Object.keys(g.skills).forEach(k => {
            g.skills[k] = Math.min(100, g.skills[k] + 4 + ~~(Math.random()*7));
        });
    }

    alert(msg);
    log(`ğŸ  ZaprosiÅ‚eÅ› ${g.name} â†’ ${msg.split('\n')[0]}`);
    renderGirls();
}

// ============================================================================
// RENDEROWANIE
// ============================================================================

function updateAll() {
    updateHeader();
    updateDashboard();
    if (document.querySelector('#page-girls.active')) renderGirls();
    if (document.querySelector('#page-events.active')) renderLog();
}

function updateHeader() {
    const d = gameState.time;
    const days = ['Nie','Pon','Wto','Åšro','Czw','PiÄ…','Sob'];
    const months = ['','sty','lut','mar','kwi','maj','cze','lip','sie','wrz','paÅº','lis','gru'];

    document.getElementById('current-hour').textContent = String(d.h).padStart(2,'0') + ':00';
    document.getElementById('current-day').textContent = days[d.dayOfWeek-1];
    document.getElementById('current-date').textContent = `${d.day} ${months[d.month]} ${d.year}`;

    document.getElementById('money').textContent = `Â¥${gameState.money.toLocaleString()}`;
    document.getElementById('debt').textContent = `Â¥${gameState.debt.toLocaleString()}`;
    document.getElementById('reputation').textContent = gameState.reputation;
    document.getElementById('empathy').textContent = `${gameState.empathy} / 100`;
    const avgM = gameState.girls.length ? ~~(gameState.girls.reduce((a,b)=>a+b.morale,0)/gameState.girls.length) : 0;
    document.getElementById('morale').textContent = `${avgM}%`;
    document.getElementById('girl-count').textContent = `${gameState.girls.length} / ${gameState.maxGirls}`;
}

function updateDashboard() {
    let income = 0;
    let active = 0;
    const breakdown = {};

    gameState.girls.forEach(g => {
        if (g.job !== 'none') {
            const inc = calculateIncome(g);
            income += inc;
            active++;
            const jn = JOBS[g.job].name;
            breakdown[jn] = (breakdown[jn] || 0) + inc;
        }
    });

    document.getElementById('daily-income').textContent = `Â¥${income.toLocaleString()}`;

    let txt = '';
    for (let k in breakdown) txt += `${k}: Â¥${breakdown[k].toLocaleString()}<br>`;
    document.getElementById('income-breakdown').innerHTML = txt || 'â€”';

    document.getElementById('active-girls').textContent = active;
}

function renderGirls() {
    const cont = document.getElementById('girls-list');
    cont.innerHTML = '';

    gameState.girls.forEach(g => {
        const j = JOBS[g.job] || JOBS.none;
        const inc = calculateIncome(g);

        let html = `
        <div class="girl-card">
            <h3>${g.name} (${g.age}) â€“ ${g.personality}</h3>
            <div class="girl-stats">
                <div class="girl-stat"><span class="label">LojalnoÅ›Ä‡:</span><span class="value">${g.loyalty}</span></div>
                <div class="progress-bar"><div class="progress-fill" style="width:${g.loyalty}%"></div></div>
                <div class="girl-stat"><span class="label">Lewdness:</span><span class="value">${g.lewdness}%</span></div>
                <div class="progress-bar"><div class="progress-fill" style="width:${g.lewdness}%"></div></div>
                <div class="girl-stat"><span class="label">Morale:</span><span class="value">${g.morale}%</span></div>
                <div class="progress-bar"><div class="progress-fill" style="width:${g.morale}%"></div></div>
            </div>
            <p><strong>UmiejÄ™tnoÅ›ci:</strong></p>
            ${Object.entries(g.skills).map(([k,v]) => `<div>${k}: ${v}</div>`).join('')}
            <p style="margin:12px 0;"><strong>Praca:</strong> ${j.name}  â†’  Â¥${inc.toLocaleString()}/dzieÅ„</p>

            <select onchange="setJob(${g.id}, this.value)">
                ${Object.entries(JOBS).map(([k,obj]) => {
                    const can = canDoJob(g, k);
                    return `<option value="${k}" ${g.job===k?'selected':''} ${can?'':'disabled'}>
                        ${obj.name} ${can?'':'(wymagany lewdness ' + obj.reqLewd + ')'}
                    </option>`;
                }).join('')}
            </select>

            <div style="margin-top:16px; display:flex; gap:8px; flex-wrap:wrap;">
                <button class="action-btn" onclick="trainLewd(${g.id})" ${gameState.money<15000?'disabled':''}>Trening lewdness (Â¥15k)</button>
                <button class="action-btn" onclick="comfort(${g.id})" ${gameState.empathy<50?'disabled':''}>Pociesz (50 empatii)</button>
                <button class="action-btn" onclick="inviteHome(${g.id})">ZaprosiÄ‡ do siebie</button>
            </div>
        </div>`;
        cont.insertAdjacentHTML('beforeend', html);
    });
}

function setJob(id, jobKey) {
    const g = gameState.girls.find(x => x.id === id);
    if (canDoJob(g, jobKey)) {
        g.job = jobKey;
        renderGirls();
        updateDashboard();
    }
}

function renderLog() {
    const cont = document.getElementById('events-log');
    cont.innerHTML = gameState.eventLog.map(e => `
        <div class="event-log-item">[${e.time}] ${e.msg}</div>
    `).join('') || '<p>Brak wpisÃ³w</p>';
}

function log(msg) {
    const t = gameState.time;
    const ts = `${t.day}.${t.month}.${t.year} ${String(t.h).padStart(2,'0')}:00`;
    gameState.eventLog.unshift({time:ts, msg});
    if (gameState.eventLog.length > 60) gameState.eventLog.pop();
    if (document.querySelector('#page-events.active')) renderLog();
}

function payDebt(amt) {
    amt = Math.min(amt, gameState.money, gameState.debt);
    if (amt <= 0) return;
    gameState.money -= amt;
    gameState.debt -= amt;
    log(`SpÅ‚acono dÅ‚ug: Â¥${amt.toLocaleString()}`);
    updateAll();
}

// ============================================================================
// ZAPIS / WCZYTYWANIE
// ============================================================================

function saveGame() {
    localStorage.setItem('gakuenSave', JSON.stringify(gameState));
    alert('Zapisano!');
}

function loadGame() {
    const data = localStorage.getItem('gakuenSave');
    if (data) {
        gameState = JSON.parse(data);
        updateAll();
        renderGirls();
        alert('Wczytano!');
    } else {
        alert('Brak zapisu.');
    }
}

// ============================================================================
// START
// ============================================================================

document.addEventListener('DOMContentLoaded', init);
</script>
<script src="js/events.js"></script>
</body>
</html>
