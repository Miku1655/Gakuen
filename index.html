<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gakuen Empire Idle</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&family=Crimson+Pro:wght@400;600&display=swap');

:root {
    --bg-dark: #1a1a2e;
    --bg-medium: #16213e;
    --bg-light: #0f3460;
    --accent-primary: #e94560;
    --accent-secondary: #f39c12;
    --text-primary: #eaeaea;
    --text-secondary: #a0a0a0;
    --success: #27ae60;
    --warning: #f39c12;
    --danger: #e74c3c;
    --menu-width: 280px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Noto Sans JP', sans-serif;
    background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
    color: var(--text-primary);
    height: 100vh;
    overflow: hidden;
    display: flex;
}

#left-menu {
    width: var(--menu-width);
    background: rgba(22, 33, 62, 0.95);
    border-right: 2px solid var(--accent-primary);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    box-shadow: 4px 0 20px rgba(233, 69, 96, 0.3);
}

.menu-header {
    padding: 30px 20px;
    background: linear-gradient(135deg, var(--accent-primary), #c23450);
    border-bottom: 3px solid rgba(255, 255, 255, 0.1);
    text-align: center;
}

.menu-header h1 {
    font-family: 'Crimson Pro', serif;
    font-size: 1.8em;
    font-weight: 700;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
}

.menu-section {
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.stat-row {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
    font-size: 0.95em;
}

.stat-row .label {
    color: var(--text-secondary);
    font-weight: 300;
}

.stat-row span:last-child {
    font-weight: 700;
    color: var(--accent-secondary);
}

.nav-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
    padding: 12px 15px;
    text-align: left;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 0.95em;
    border-radius: 4px;
    margin: 5px 0;
}

.nav-btn:hover {
    background: rgba(233, 69, 96, 0.2);
    border-color: var(--accent-primary);
    transform: translateX(5px);
}

.nav-btn.active {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    font-weight: 700;
}

.time-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    padding: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.85em;
    border-radius: 4px;
    flex: 1;
    margin: 3px;
}

.time-btn:hover {
    background: rgba(243, 156, 18, 0.3);
}

.time-btn.active {
    background: var(--accent-secondary);
    font-weight: 700;
}

.action-btn {
    background: linear-gradient(135deg, var(--accent-primary), #c23450);
    border: none;
    color: white;
    padding: 12px;
    margin: 5px 0;
    cursor: pointer;
    font-family: 'Noto Sans JP', sans-serif;
    font-weight: 700;
    font-size: 0.9em;
    border-radius: 4px;
    transition: all 0.3s ease;
    width: 100%;
}

.action-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(233, 69, 96, 0.4);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

#main-content {
    flex: 1;
    overflow-y: auto;
    padding: 40px;
}

.page {
    display: none;
    animation: fadeIn 0.5s ease;
}

.page.active { display: block; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

h2 {
    font-family: 'Crimson Pro', serif;
    font-size: 2.5em;
    margin-bottom: 30px;
    color: var(--accent-primary);
    text-shadow: 2px 2px 10px rgba(233, 69, 96, 0.3);
    border-bottom: 2px solid rgba(233, 69, 96, 0.3);
    padding-bottom: 10px;
}

h3 {
    font-family: 'Crimson Pro', serif;
    color: var(--accent-secondary);
    margin: 20px 0 10px 0;
    font-size: 1.4em;
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.dashboard-card {
    background: rgba(22, 33, 62, 0.6);
    border: 1px solid rgba(233, 69, 96, 0.3);
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4);
}

#girls-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    gap: 20px;
}

.girl-card {
    background: rgba(22, 33, 62, 0.8);
    border: 2px solid rgba(233, 69, 96, 0.2);
    border-radius: 8px;
    padding: 20px;
    transition: all 0.3s ease;
}

.girl-card:hover {
    border-color: var(--accent-primary);
    box-shadow: 0 10px 30px rgba(233, 69, 96, 0.3);
}

.girl-stats {
    margin: 15px 0;
}

.girl-stat {
    display: flex;
    justify-content: space-between;
    margin: 8px 0 3px 0;
    font-size: 0.9em;
}

.girl-stat .label { color: var(--text-secondary); }
.girl-stat .value { color: var(--accent-secondary); font-weight: 700; }

.progress-bar {
    background: rgba(255, 255, 255, 0.1);
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
    margin: 5px 0 15px 0;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    transition: width 0.3s ease;
}

.girl-card select {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    border-radius: 4px;
    font-family: 'Noto Sans JP', sans-serif;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal.active { display: flex; }

.modal-content {
    background: linear-gradient(135deg, var(--bg-medium), var(--bg-light));
    border: 2px solid var(--accent-primary);
    border-radius: 12px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.modal-content h3 {
    color: var(--accent-primary);
    margin-bottom: 20px;
    font-size: 1.8em;
}

.modal-content p {
    line-height: 1.7;
    margin-bottom: 20px;
    white-space: pre-line;
}

#event-choices {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.choice-btn {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(233, 69, 96, 0.5);
    color: var(--text-primary);
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    border-radius: 6px;
}

.choice-btn:hover:not(:disabled) {
    background: rgba(233, 69, 96, 0.2);
    border-color: var(--accent-primary);
    transform: translateX(10px);
}

.choice-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.event-log-container {
    max-height: 600px;
    overflow-y: auto;
    background: rgba(22, 33, 62, 0.6);
    border: 1px solid rgba(233, 69, 96, 0.3);
    border-radius: 8px;
    padding: 20px;
}

.event-log-item {
    padding: 12px;
    margin: 8px 0;
    background: rgba(255, 255, 255, 0.05);
    border-left: 3px solid var(--accent-primary);
    border-radius: 4px;
}

.investment-card, .city-card {
    background: rgba(22, 33, 62, 0.6);
    border: 1px solid rgba(233, 69, 96, 0.3);
    border-radius: 8px;
    padding: 20px;
    margin: 10px 0;
}

.requirement {
    color: var(--warning);
    font-size: 0.9em;
    margin: 5px 0;
}

.requirement.met { color: var(--success); }

.tooltip {
    position: relative;
    display: inline-block;
    cursor: help;
    border-bottom: 1px dotted var(--text-secondary);
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 250px;
    background-color: var(--bg-dark);
    color: var(--text-primary);
    text-align: left;
    border-radius: 6px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -125px;
    opacity: 0;
    transition: opacity 0.3s;
    border: 1px solid var(--accent-primary);
    font-size: 0.85em;
    line-height: 1.4;
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: var(--bg-dark); }
::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 5px; }
    </style>
</head>
<body>
    <div id="left-menu">
        <div class="menu-header">
            <h1>Gakuen Empire</h1>
        </div>
        
        <div class="menu-section time-display">
            <div class="stat-row">
                <span class="label">Godzina:</span>
                <span id="current-hour">08:00</span>
            </div>
            <div class="stat-row">
                <span class="label">Dzie≈Ñ:</span>
                <span id="current-day">Poniedzia≈Çek</span>
            </div>
            <div class="stat-row">
                <span class="label">Data:</span>
                <span id="current-date">1 Kwietnia 2025</span>
            </div>
        </div>

        <div class="menu-section stats-display">
            <div class="stat-row">
                <span class="label">Got√≥wka:</span>
                <span id="money">¬•800,000</span>
            </div>
            <div class="stat-row">
                <span class="label">D≈Çug:</span>
                <span id="debt">¬•5,000,000</span>
            </div>
            <div class="stat-row">
                <span class="label">Reputacja:</span>
                <span id="reputation">45</span>
            </div>
            <div class="stat-row">
                <span class="label">≈örednia ocen:</span>
                <span id="grades">0.0</span>
            </div>
            <div class="stat-row">
                <span class="label">Morale:</span>
                <span id="morale">65%</span>
            </div>
        </div>

        <div class="menu-section navigation">
            <button class="nav-btn active" data-page="dashboard">üìä Dashboard</button>
            <button class="nav-btn" data-page="girls">üë• Dziewczyny</button>
            <button class="nav-btn" data-page="school">üè´ Szko≈Ça</button>
            <button class="nav-btn" data-page="business">üíº Biznes</button>
            <button class="nav-btn" data-page="city">üåÜ Miasto</button>
            <button class="nav-btn" data-page="events">üì∞ Wydarzenia</button>
            <button class="nav-btn" data-page="options">‚öôÔ∏è Opcje</button>
        </div>

        <div class="menu-section time-controls">
            <div style="display: flex; flex-wrap: wrap;">
                <button id="pause-btn" class="time-btn" style="flex: 1 1 100%;">‚ñ∂ Start</button>
                <button id="speed-1x" class="time-btn active">1x</button>
                <button id="speed-5x" class="time-btn">5x</button>
                <button id="speed-10x" class="time-btn">10x</button>
            </div>
        </div>

        <div class="menu-section save-controls">
            <button id="save-btn" class="action-btn">üíæ Zapisz</button>
            <button id="load-btn" class="action-btn">üìÇ Wczytaj</button>
        </div>
    </div>

    <div id="main-content">
        <div id="page-dashboard" class="page active">
            <h2>Dashboard - Seiran Academy</h2>
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>üìã Status Szko≈Çy</h3>
                    <p>Witaj, Dyrektorze. Twoja szko≈Ça boryka siƒô z ogromnym d≈Çugiem w wysoko≈õci ¬•5,000,000.</p>
                    <p><strong>D≈Çug ro≈õnie:</strong> ~0.08% dziennie (~30% rocznie)</p>
                    <button onclick="payDebt(100000)" class="action-btn" style="margin-top: 15px;">Sp≈Çaƒá ¬•100,000 d≈Çugu</button>
                    <button onclick="payDebt(500000)" class="action-btn">Sp≈Çaƒá ¬•500,000 d≈Çugu</button>
                    <button onclick="payDebt(gameState.money)" class="action-btn">Sp≈Çaƒá wszystko</button>
                </div>
                <div class="dashboard-card">
                    <h3>üí∞ Dzienny Przych√≥d</h3>
                    <p style="font-size: 2em; font-weight: bold; color: var(--accent-secondary);" id="daily-income">¬•0</p>
                    <p id="income-breakdown"></p>
                </div>
                <div class="dashboard-card">
                    <h3>üë• Aktywne Dziewczyny</h3>
                    <p style="font-size: 2em; font-weight: bold; color: var(--accent-primary);" id="active-girls">0/0</p>
                </div>
                <div class="dashboard-card">
                    <h3>üìà Wskaz√≥wki</h3>
                    <p>‚úì Przypisz dziewczyny do Randek Szkolnych</p>
                    <p>‚úì Trenuj lewdness (¬•15k ka≈ºdy trening)</p>
                    <p>‚úì Czekaj na wydarzenia (losowe co kilka godzin)</p>
                    <p>‚úì Dbaj o morale - pocieszaj gdy < 50%</p>
                </div>
            </div>
        </div>

        <div id="page-girls" class="page">
            <h2>üë• ZarzƒÖdzanie Dziewczynami</h2>
            <div id="girls-list"></div>
        </div>

        <div id="page-school" class="page">
            <h2>üè´ ZarzƒÖdzanie Szko≈ÇƒÖ</h2>
            <div id="school-investments"></div>
        </div>

        <div id="page-business" class="page">
            <h2>üíº Operacje Biznesowe</h2>
            <div id="business-operations"></div>
        </div>

        <div id="page-city" class="page">
            <h2>üåÜ Miasta i Lokacje</h2>
            <div id="city-locations"></div>
        </div>

        <div id="page-events" class="page">
            <h2>üì∞ Historia Wydarze≈Ñ</h2>
            <div id="events-log"></div>
        </div>

        <div id="page-options" class="page">
            <h2>‚öôÔ∏è Opcje</h2>
            <div style="max-width: 600px;">
                <h3>ZarzƒÖdzanie Zapisem</h3>
                <p>Gra auto-zapisuje co 7 dni.</p>
                <h3 style="margin-top: 30px; color: var(--danger);">Reset</h3>
                <button id="reset-game" class="action-btn" style="background: var(--danger);">üîÑ Resetuj Grƒô</button>
            </div>
        </div>
    </div>

    <div id="event-modal" class="modal">
        <div class="modal-content">
            <h3 id="event-title"></h3>
            <p id="event-description"></p>
            <div id="event-choices"></div>
        </div>
    </div>

    <script>
// ============================================================================
// GAME DATA
// ============================================================================

const GIRLS_DATA = [
    {
        id: 1, name: "Sakura Tanaka", age: 18,
        personality: "Nie≈õmia≈Ça i wra≈ºliwa",
        backstory: "Uczennica Seiran Academy z trudnej rodziny. Ojciec straci≈Ç pracƒô.",
        loyalty: 50, lewdness: 10, grades: 85, morale: 60,
        skills: { conversation: 30, handjob: 5, blowjob: 0, vaginal: 0, anal: 0 },
        currentJob: "none", traits: ["virgin", "shy", "smart"], available: true
    },
    {
        id: 2, name: "Yuki Nakamura", age: 19,
        personality: "Pewna siebie i ambitna",
        backstory: "Popularna w Seiran, ukrywa biedƒô rodziny.",
        loyalty: 40, lewdness: 30, grades: 70, morale: 75,
        skills: { conversation: 60, handjob: 20, blowjob: 10, vaginal: 0, anal: 0 },
        currentJob: "none", traits: ["athletic", "confident"], available: true
    },
    {
        id: 3, name: "Mei Kobayashi", age: 18,
        personality: "Skryta i mroczna",
        backstory: "Nowa w Seiran po przeniesieniu. Rodzina straci≈Ça dom.",
        loyalty: 60, lewdness: 5, grades: 95, morale: 40,
        skills: { conversation: 15, handjob: 0, blowjob: 0, vaginal: 0, anal: 0 },
        currentJob: "none", traits: ["virgin", "otaku", "genius"], available: true
    }
];

const JOBS_DATA = {
    none: { name: "Bez pracy", baseIncome: 0, risk: 0, requiredLewdness: 0 },
    school_dates: {
        name: "Randki Szkolne", baseIncome: 5000, risk: 10, requiredLewdness: 5,
        requiredSkills: { conversation: 20 },
        description: "Dyskretne randki z uczniami. Wymagania: Lewdness 5+, Conversation 20+"
    },
    hostess: {
        name: "Hostess Bar", baseIncome: 15000, risk: 25, requiredLewdness: 20,
        requiredSkills: { conversation: 40 },
        description: "Praca w barze. Wymagania: Lewdness 20+, Conversation 40+"
    },
    delivery: {
        name: "Delivery Health", baseIncome: 30000, risk: 45, requiredLewdness: 50,
        requiredSkills: { conversation: 30, handjob: 40, blowjob: 30 },
        description: "Us≈Çugi z dojazdem. Wymagania: Lewdness 50+, Conversation 30+, Handjob 40+, Blowjob 30+"
    },
    soapland: {
        name: "Soapland", baseIncome: 60000, risk: 60, requiredLewdness: 70,
        requiredSkills: { conversation: 40, handjob: 50, blowjob: 60, vaginal: 50 },
        description: "Salon erotyczny. Wymagania: Lewdness 70+, Conversation 40+, Handjob 50+, Blowjob 60+, Vaginal 50+"
    },
    vip: {
        name: "Us≈Çugi VIP", baseIncome: 120000, risk: 80, requiredLewdness: 85,
        requiredSkills: { conversation: 70, handjob: 70, blowjob: 80, vaginal: 70, anal: 50 },
        description: "Elita. Wymagania: Lewdness 85+, wszystkie skille 50+"
    }
};

const EVENTS_DATA = [
    {
        id: "date_return_1", title: "Powr√≥t z Randki",
        description: "Sakura wraca z randki zmƒôczona. Trzyma kopertƒô z pieniƒôdzmi.\n\n\"Uda≈Ço siƒô... Ch≈Çopak by≈Ç mi≈Çy, ale nachalne.\"\n\nJej oczy b≈ÇyszczƒÖ wilgociƒÖ.",
        conditions: { minGirls: 1 }, chance: 25, cooldown: 5,
        choices: [
            { text: "Przytul jƒÖ i pochwal", effects: { loyalty: 10, morale: 15, money: 5000 }, followUpText: "Sakura przytula siƒô i p≈Çacze. \"Dziƒôkujƒô...\"" },
            { text: "We≈∫ pieniƒÖdze bez s≈Çowa", effects: { loyalty: -5, morale: -10, money: 5000 }, followUpText: "WyglƒÖda zraniona." }
        ]
    },
    {
        id: "yakuza_offer", title: "Propozycja Yakuzy",
        description: "Mƒô≈ºczyzna w czarnym garniturze wchodzi do biura. Tatua≈ºe na rƒôkach.\n\n\"Prowadzisz interesujƒÖcy biznes. Jestem Takeshi z klanu Yamaguchi. Ochrona za 15% zysk√≥w?\"",
        conditions: { minMoney: 100000, minGirls: 2 }, chance: 15, oneTime: true,
        choices: [
            { text: "Przyjmij (15% podatek, -20 risk, +10 rep)", cost: 0, effects: { yakuzaProtection: true, profitTax: 15, reputation: 10, risk: -20 }, followUpText: "\"MƒÖdra decyzja. Jeste≈õ pod opiekƒÖ.\"" },
            { text: "Odm√≥w grzecznie", cost: 0, effects: { risk: 10 }, followUpText: "\"Rozumiem. Je≈õli zmienisz zdanie...\"" }
        ]
    },
    {
        id: "unlock_hostess", title: "Oferta Hostess Bar",
        description: "Prawnik dzwoni: 'Lokal w Shibuya. Hostess bar. Start: ¬•1M got√≥wki, koszt ¬•100k.'",
        conditions: { minMoney: 1000000, minReputation: 20 }, chance: 40, oneTime: true,
        choices: [
            { text: "Otw√≥rz Bar (-¬•100k)", cost: 100000, effects: { unlockJob: "hostess" }, followUpText: "‚úÖ Hostess Bar otwarty!" },
            { text: "Odm√≥w", cost: 0, effects: {}, followUpText: "Szansa przepad≈Ça." }
        ]
    },
    {
        id: "unlock_delivery", title: "Agencja Delivery",
        description: "Kobieta dzwoni: 'Widzia≈Çam dziewczyny. Delivery health? Potrzeba 3+ dziewczyn i ochrony Yakuzy.'",
        conditions: { minGirls: 3, yakuza: true }, chance: 35, oneTime: true,
        choices: [
            { text: "Podpisz umowƒô", cost: 0, effects: { unlockJob: "delivery" }, followUpText: "‚úÖ Delivery Health dostƒôpne!" },
            { text: "Odm√≥w", cost: 0, effects: {}, followUpText: "Mo≈ºe p√≥≈∫niej..." }
        ]
    },
    {
        id: "unlock_soapland", title: "Propozycja Soapland",
        description: "Yakuza: 'Masz kasƒô i dziewczyny. Soapland? Koszt ¬•2M.'",
        conditions: { minMoney: 5000000 }, chance: 25, oneTime: true,
        choices: [
            { text: "Inwestuj (-¬•2M)", cost: 2000000, effects: { unlockJob: "soapland" }, followUpText: "‚úÖ Soapland otwarty!" },
            { text: "Odm√≥w", cost: 0, effects: {}, followUpText: "Za drogo..." }
        ]
    },
    {
        id: "recruit_student", title: "Nowa Uczennica",
        description: "Transferka w klasie 1-A. WyglƒÖda zagubiona. Porozmawiaƒá? Koszt rekrutacji: ¬•50k.",
        conditions: { minReputation: 30, minMoney: 50000 }, chance: 8, cooldown: 10,
        choices: [
            { text: "Zaproponuj pracƒô (-¬•50k)", cost: 50000, effects: { addGirl: true, reputation: 5 }, followUpText: "‚úÖ Nowa dziewczyna!" },
            { text: "Zignoruj", cost: 0, effects: {}, followUpText: "Szansa przepad≈Ça." }
        ]
    },
    {
        id: "low_morale", title: "Kryzys Morale",
        description: "Dziewczyny sƒÖ wyczerpane. Gro≈ºƒÖ odej≈õciem. Premia ¬•50k?",
        conditions: { minMorale: 0, maxMorale: 35, minMoney: 50000 }, chance: 50, cooldown: 7,
        choices: [
            { text: "Daj premiƒô (-¬•50k)", cost: 50000, effects: { morale: 20, loyalty: 10 }, followUpText: "Atmosfera siƒô poprawia." },
            { text: "Ignoruj", cost: 0, effects: { morale: -10, loyalty: -15, risk: 20 }, followUpText: "Sytuacja pogarsza siƒô..." }
        ]
    }
];

const SCHOOL_INVESTMENTS = [
    {
        id: "renovation", name: "Renowacja klas", cost: 100000,
        effects: { reputation: 5, grades: 10 },
        description: "Od≈õwie≈º sale. +5 reputacji, +10 ≈õrednia ocen."
    },
    {
        id: "sports", name: "Obiekt sportowy", cost: 250000,
        effects: { reputation: 10, morale: 15 },
        description: "Boisko i si≈Çownia. +10 reputacji, +15 morale wszystkim."
    },
    {
        id: "secret_rooms", name: "Tajne pokoje", cost: 500000,
        effects: { risk: -10 },
        description: "Ukryte pomieszczenia. -10 ryzyko."
    }
];

// ============================================================================
// GAME STATE
// ============================================================================

let gameState = {
    time: { hour: 8, dayOfWeek: 1, day: 1, month: 4, year: 2025 },
    money: 800000, debt: 5000000, reputation: 45, moraleTotal: 65,
    girls: [], gameSpeed: 1, isPaused: true,
    yakuzaProtection: false, profitTax: 0, risk: 15,
    unlockedJobs: ['none', 'school_dates'],
    completedEvents: [], eventLog: [], eventCooldowns: {},
    purchasedInvestments: [], nextGirlId: 4, lastEventCheck: 0
};

const TIME_PER_TICK_MS = 3000;
let gameLoopInterval;

// ============================================================================
// INIT
// ============================================================================

function initGame() {
    gameState.girls = GIRLS_DATA.map(g => ({...g}));
    updateAll();
    setupUI();
    startGameLoop();
    console.log("‚úÖ Game ready!");
}

function setupUI() {
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.onclick = () => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`page-${btn.dataset.page}`).classList.add('active');
            btn.classList.add('active');
            if (btn.dataset.page === 'girls') renderGirls();
            if (btn.dataset.page === 'events') renderEventLog();
            if (btn.dataset.page === 'school') renderSchool();
            if (btn.dataset.page === 'business') renderBusiness();
            if (btn.dataset.page === 'city') renderCities();
        };
    });

    document.getElementById('pause-btn').onclick = () => {
        gameState.isPaused = !gameState.isPaused;
        document.getElementById('pause-btn').textContent = gameState.isPaused ? '‚ñ∂ Start' : '‚è∏ Pauza';
    };

    ['1','5','10'].forEach(s => {
        document.getElementById(`speed-${s}x`).onclick = () => {
            gameState.gameSpeed = parseInt(s);
            document.querySelectorAll('.time-btn:not(#pause-btn)').forEach(b => b.classList.remove('active'));
            document.getElementById(`speed-${s}x`).classList.add('active');
            startGameLoop();
        };
    });

    document.getElementById('save-btn').onclick = () => saveGame();
    document.getElementById('load-btn').onclick = () => loadGame();
    document.getElementById('reset-game').onclick = () => {
        if (confirm('Resetowaƒá grƒô?')) {
            localStorage.removeItem('gakuen_save');
            location.reload();
        }
    };
}

// ============================================================================
// GAME LOOP
// ============================================================================

function startGameLoop() {
    if (gameLoopInterval) clearInterval(gameLoopInterval);
    gameLoopInterval = setInterval(() => {
        if (!gameState.isPaused) tick();
    }, TIME_PER_TICK_MS / gameState.gameSpeed);
}

function tick() {
    gameState.time.hour++;
    gameState.lastEventCheck++;

    if (gameState.time.hour >= 24) {
        gameState.time.hour = 0;
        gameState.time.dayOfWeek = (gameState.time.dayOfWeek % 7) + 1;
        gameState.time.day++;
        dailyCycle();

        if (gameState.time.day > 30) {
            gameState.time.day = 1;
            gameState.time.month++;
            if (gameState.time.month > 12) {
                gameState.time.month = 1;
                gameState.time.year++;
            }
        }
    }

    updateAll();

    // Cooldown event timers
    for (let id in gameState.eventCooldowns) {
        gameState.eventCooldowns[id]--;
        if (gameState.eventCooldowns[id] <= 0) delete gameState.eventCooldowns[id];
    }

    // Try trigger event every 3+ hours
    if (gameState.lastEventCheck >= 3 && Math.random() < 0.15) {
        triggerRandomEvent();
        gameState.lastEventCheck = 0;
    }
}

function dailyCycle() {
    let income = 0;

    gameState.girls.forEach(g => {
        if (g.currentJob && g.currentJob !== 'none') {
            income += calculateIncome(g, g.currentJob);
            const job = JOBS_DATA[g.currentJob];
            if (job.risk > 30) g.morale = Math.max(10, g.morale - Math.floor(job.risk / 20));
            if (g.morale < 30) g.loyalty = Math.max(0, g.loyalty - 2);
            else if (g.morale > 70) g.loyalty = Math.min(100, g.loyalty + 1);
        }
    });

    if (income > 0) {
        let afterTax = income;
        if (gameState.yakuzaProtection) afterTax -= Math.floor(income * gameState.profitTax / 100);
        gameState.money += afterTax;
        logEvent(`üìä Dzienny przych√≥d: ¬•${afterTax.toLocaleString()}`, 'income');
    }

    gameState.debt += Math.floor(gameState.debt * 0.0008);
    updateAverageMorale();

    if (gameState.time.day % 7 === 0) saveGame(true);
}

// ============================================================================
// CALCULATIONS
// ============================================================================

function calculateIncome(girl, jobKey) {
    const job = JOBS_DATA[jobKey];
    if (!job) return 0;

    let income = job.baseIncome;
    income *= (1 + girl.loyalty / 200);
    income *= (0.5 + girl.morale / 200);

    const req = job.requiredSkills || {};
    for (let skill in req) {
        if (girl.skills[skill]) income *= (1 + girl.skills[skill] / 300);
    }

    return Math.floor(income);
}

function canAssignJob(girl, jobKey) {
    const job = JOBS_DATA[jobKey];
    if (!job || !gameState.unlockedJobs.includes(jobKey)) return false;
    if (girl.lewdness < job.requiredLewdness) return false;

    const req = job.requiredSkills || {};
    for (let skill in req) {
        if ((girl.skills[skill] || 0) < req[skill]) return false;
    }
    return true;
}

function updateAverageMorale() {
    if (gameState.girls.length === 0) { gameState.moraleTotal = 0; return; }
    gameState.moraleTotal = Math.floor(gameState.girls.reduce((s,g) => s + g.morale, 0) / gameState.girls.length);
}

// ============================================================================
// UI UPDATES
// ============================================================================

function updateAll() {
    updateTime();
    updateDashboard();
    if (document.getElementById('page-girls').classList.contains('active')) renderGirls();
}

function updateTime() {
    const days = ['Ndz','Pon','Wt','≈ör','Czw','Pt','Sob'];
    const months = ['','Sty','Lut','Mar','Kwi','Maj','Cze','Lip','Sie','Wrz','Pa≈∫','Lis','Gru'];
    document.getElementById('current-hour').textContent = String(gameState.time.hour).padStart(2,'0') + ':00';
    document.getElementById('current-day').textContent = days[gameState.time.dayOfWeek];
    document.getElementById('current-date').textContent = `${gameState.time.day} ${months[gameState.time.month]} ${gameState.time.year}`;
}

function updateDashboard() {
    document.getElementById('money').textContent = `¬•${gameState.money.toLocaleString()}`;
    document.getElementById('debt').textContent = `¬•${gameState.debt.toLocaleString()}`;
    document.getElementById('reputation').textContent = gameState.reputation;
    document.getElementById('morale').textContent = `${gameState.moraleTotal}%`;

    const avg = gameState.girls.length ? gameState.girls.reduce((s,g) => s + g.grades, 0) / gameState.girls.length : 0;
    document.getElementById('grades').textContent = avg.toFixed(1);

    const income = gameState.girls.reduce((s,g) => s + (g.currentJob !== 'none' ? calculateIncome(g, g.currentJob) : 0), 0);
    document.getElementById('daily-income').textContent = `¬•${income.toLocaleString()}`;

    const active = gameState.girls.filter(g => g.currentJob !== 'none').length;
    document.getElementById('active-girls').textContent = `${active}/${gameState.girls.length}`;

    // Breakdown
    const breakdown = {};
    gameState.girls.forEach(g => {
        if (g.currentJob !== 'none') {
            const job = JOBS_DATA[g.currentJob].name;
            breakdown[job] = (breakdown[job] || 0) + calculateIncome(g, g.currentJob);
        }
    });
    let breakdownText = '';
    for (let job in breakdown) {
        breakdownText += `${job}: ¬•${breakdown[job].toLocaleString()}<br>`;
    }
    document.getElementById('income-breakdown').innerHTML = breakdownText || 'Brak przychod√≥w';
}

function renderGirls() {
    const container = document.getElementById('girls-list');
    if (!gameState.girls.length) {
        container.innerHTML = '<p>Brak dziewczyn. Rekrutuj przez wydarzenia!</p>';
        return;
    }

    let html = '';
    gameState.girls.forEach(g => {
        const job = JOBS_DATA[g.currentJob];
        const income = calculateIncome(g, g.currentJob);

        html += `<div class="girl-card">
            <h3>${g.name} (${g.age} lat)</h3>
            <p><strong>${g.personality}</strong></p>
            <p><em>${g.backstory}</em></p>
            <p>Cechy: ${g.traits.join(', ')}</p>

            <div class="girl-stats">
                ${renderStat('Lojalno≈õƒá', g.loyalty)}
                ${renderStat('Lewdness', g.lewdness)}
                ${renderStat('Morale', g.morale)}
                ${renderStat('Oceny', g.grades, true)}
                ${renderSkills(g.skills)}
            </div>

            <hr style="margin:15px 0;border-color:rgba(255,255,255,0.1);">

            <p><strong>Praca:</strong> ${job.name}</p>
            <p><strong>Dzienny doch√≥d:</strong> ¬•${income.toLocaleString()}</p>

            <select onchange="changeJob(${g.id}, this.value)" style="width:100%;padding:8px;margin:10px 0;">
                ${Object.keys(JOBS_DATA).filter(j => gameState.unlockedJobs.includes(j)).map(j => {
                    const canDo = canAssignJob(g, j);
                    return `<option value="${j}" ${g.currentJob === j ? 'selected' : ''} ${!canDo ? 'disabled' : ''}>
                        ${JOBS_DATA[j].name} ${!canDo ? '(üîí)' : ''}
                    </option>`;
                }).join('')}
            </select>

            ${Object.keys(JOBS_DATA).map(j => {
                if (j === 'none' || gameState.unlockedJobs.includes(j)) return '';
                return `<p style="font-size:0.85em;color:var(--text-secondary);">üîí ${JOBS_DATA[j].name} - odblokuj przez wydarzenia</p>`;
            }).join('')}

            <div style="display:flex;gap:5px;margin-top:10px;">
                <button onclick="trainGirl(${g.id})" class="action-btn" style="flex:1;" ${gameState.money < 15000 ? 'disabled' : ''}>
                    üìö Trening (¬•15k)
                </button>
                <button onclick="comfortGirl(${g.id})" class="action-btn" style="flex:1;" ${g.morale >= 50 ? 'disabled' : ''}>
                    ‚ù§Ô∏è Pociesz ${g.morale >= 50 ? '(‚â•50%)' : ''}
                </button>
            </div>
        </div>`;
    });

    container.innerHTML = html;
}

function renderStat(label, value, noBar) {
    return `
        <div class="girl-stat">
            <span class="label">${label}:</span>
            <span class="value">${value}${noBar ? '' : '%'}</span>
        </div>
        ${noBar ? '' : `<div class="progress-bar"><div class="progress-fill" style="width:${value}%"></div></div>`}
    `;
}

function renderSkills(skills) {
    let html = '<div style="margin-top:10px;font-size:0.9em;">';
    for (let skill in skills) {
        html += `<div style="display:flex;justify-content:space-between;margin:3px 0;">
            <span style="text-transform:capitalize;">${skill}:</span>
            <span style="color:var(--accent-secondary);">${skills[skill]}</span>
        </div>`;
    }
    return html + '</div>';
}

function changeJob(girlId, jobKey) {
    const girl = gameState.girls.find(g => g.id === girlId);
    if (canAssignJob(girl, jobKey)) {
        girl.currentJob = jobKey;
        logEvent(`${girl.name} ‚Üí ${JOBS_DATA[jobKey].name}`, 'job');
        renderGirls();
        updateDashboard();
    }
}

function trainGirl(girlId) {
    if (gameState.money < 15000) return;
    const girl = gameState.girls.find(g => g.id === girlId);
    gameState.money -= 15000;
    const gain = 8 + Math.floor(Math.random() * 5);
    girl.lewdness = Math.min(100, girl.lewdness + gain);
    girl.morale = Math.max(0, girl.morale - 3);

    // Train random skill
    const skills = Object.keys(girl.skills);
    const skill = skills[Math.floor(Math.random() * skills.length)];
    girl.skills[skill] = Math.min(100, girl.skills[skill] + 3 + Math.floor(Math.random() * 3));

    logEvent(`${girl.name}: Lewdness +${gain}, ${skill} +trening`, 'training');
    renderGirls();
    updateDashboard();
}

function comfortGirl(girlId) {
    const girl = gameState.girls.find(g => g.id === girlId);
    if (girl.morale >= 50) return;
    girl.morale = Math.min(100, girl.morale + 15);
    girl.loyalty = Math.min(100, girl.loyalty + 5);
    logEvent(`Pocieszy≈Çe≈õ ${girl.name}`, 'comfort');
    renderGirls();
    updateDashboard();
}

function payDebt(amount) {
    amount = Math.min(amount, gameState.money, gameState.debt);
    if (amount <= 0) return;
    gameState.money -= amount;
    gameState.debt -= amount;
    logEvent(`Sp≈Çacono ¬•${amount.toLocaleString()} d≈Çugu`, 'debt');
    updateDashboard();

    if (gameState.debt <= 0) {
        alert('üéâ D≈ÅUG SP≈ÅACONY! Gratulacje! Teraz mo≈ºesz rozwijaƒá imperium bez presji.');
        gameState.debt = 0;
    }
}

// ============================================================================
// EVENTS
// ============================================================================

function triggerRandomEvent() {
    const available = EVENTS_DATA.filter(e => {
        if (e.oneTime && gameState.completedEvents.includes(e.id)) return false;
        if (gameState.eventCooldowns[e.id]) return false;

        const c = e.conditions || {};
        if (c.minMoney && gameState.money < c.minMoney) return false;
        if (c.minReputation && gameState.reputation < c.minReputation) return false;
        if (c.minGirls && gameState.girls.length < c.minGirls) return false;
        if (c.minMorale && gameState.moraleTotal < c.minMorale) return false;
        if (c.maxMorale && gameState.moraleTotal > c.maxMorale) return false;
        if (c.yakuza !== undefined && gameState.yakuzaProtection !== c.yakuza) return false;

        return Math.random() * 100 < (e.chance || 100);
    });

    if (!available.length) return;
    const event = available[Math.floor(Math.random() * available.length)];
    showEvent(event);
}

function showEvent(event) {
    document.getElementById('event-title').textContent = event.title;
    document.getElementById('event-description').textContent = event.description;

    const choices = document.getElementById('event-choices');
    choices.innerHTML = '';

    event.choices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = choice.text;

        const cost = choice.cost || 0;
        if (cost > 0 && gameState.money < cost) {
            btn.disabled = true;
            btn.textContent += ` (Za ma≈Ço ¬•)`;
        }

        btn.onclick = () => selectChoice(event, choice);
        choices.appendChild(btn);
    });

    document.getElementById('event-modal').classList.add('active');
    gameState.isPaused = true;
    document.getElementById('pause-btn').textContent = '‚è∏ Pauza';
}

function selectChoice(event, choice) {
    const cost = choice.cost || 0;
    if (cost > gameState.money) return;

    if (cost > 0) gameState.money -= cost;

    const e = choice.effects || {};
    if (e.money) gameState.money += e.money;
    if (e.reputation) gameState.reputation = Math.max(0, Math.min(100, gameState.reputation + e.reputation));
    if (e.risk) gameState.risk = Math.max(0, Math.min(100, gameState.risk + e.risk));
    if (e.morale) gameState.girls.forEach(g => g.morale = Math.max(0, Math.min(100, g.morale + e.morale)));
    if (e.loyalty) gameState.girls.forEach(g => g.loyalty = Math.max(0, Math.min(100, g.loyalty + e.loyalty)));
    if (e.yakuzaProtection !== undefined) gameState.yakuzaProtection = e.yakuzaProtection;
    if (e.profitTax) gameState.profitTax = e.profitTax;
    if (e.unlockJob && !gameState.unlockedJobs.includes(e.unlockJob)) {
        gameState.unlockedJobs.push(e.unlockJob);
        logEvent(`üîì ${JOBS_DATA[e.unlockJob].name}`, 'unlock');
    }
    if (e.addGirl) addRandomGirl();

    logEvent(`üì∞ ${event.title}`, 'event');
    gameState.completedEvents.push(event.id);
    if (event.cooldown) gameState.eventCooldowns[event.id] = event.cooldown;

    if (choice.followUpText) alert(choice.followUpText);

    document.getElementById('event-modal').classList.remove('active');
    // AUTO-RESUME
    gameState.isPaused = false;
    document.getElementById('pause-btn').textContent = '‚è∏ Pauza';
    updateAll();
}

function addRandomGirl() {
    const names = ['Hana','Aiko','Yui','Rin','Nao','Saki'];
    const girl = {
        id: gameState.nextGirlId++,
        name: names[Math.floor(Math.random() * names.length)] + ' ' + ['Sato','Ito','Kato'][Math.floor(Math.random() * 3)],
        age: 18 + Math.floor(Math.random() * 3),
        personality: ['Nie≈õmia≈Ça','Ambitna','Weso≈Ça'][Math.floor(Math.random() * 3)],
        backstory: 'Nowa rekrutka z problemami finansowymi.',
        loyalty: 30 + Math.floor(Math.random() * 30),
        lewdness: 10 + Math.floor(Math.random() * 20),
        grades: 70 + Math.floor(Math.random() * 20),
        morale: 50 + Math.floor(Math.random() * 30),
        skills: {
            conversation: 20 + Math.floor(Math.random() * 30),
            handjob: Math.floor(Math.random() * 20),
            blowjob: Math.floor(Math.random() * 10),
            vaginal: 0, anal: 0
        },
        currentJob: 'none',
        traits: ['newbie'],
        available: true
    };
    gameState.girls.push(girl);
    logEvent(`‚ú® ${girl.name} do≈ÇƒÖczy≈Ça!`, 'recruit');
}

function logEvent(msg, type) {
    const ts = `${gameState.time.day}/${gameState.time.month} ${String(gameState.time.hour).padStart(2,'0')}:00`;
    gameState.eventLog.unshift({ ts, msg, type });
    if (gameState.eventLog.length > 50) gameState.eventLog = gameState.eventLog.slice(0, 50);
}

function renderEventLog() {
    const container = document.getElementById('events-log');
    if (!gameState.eventLog.length) {
        container.innerHTML = '<p>Brak wydarze≈Ñ</p>';
        return;
    }

    let html = '<div class="event-log-container">';
    gameState.eventLog.forEach(log => {
        const icons = { income:'üí∞', job:'üíº', training:'üìö', comfort:'‚ù§Ô∏è', event:'üì∞', unlock:'üîì', recruit:'‚ú®', debt:'üí≥' };
        html += `<div class="event-log-item">
            <span class="event-time">[${log.ts}]</span>
            <span>${icons[log.type] || 'üìã'} ${log.msg}</span>
        </div>`;
    });
    container.innerHTML = html + '</div>';
}

// ============================================================================
// SCHOOL
// ============================================================================

function renderSchool() {
    const container = document.getElementById('school-investments');
    let html = '<h3>Inwestycje w Seiran Academy</h3><p>Ulepszenia zwiƒôkszajƒÖ reputacjƒô i morale dziewczyn.</p>';

    SCHOOL_INVESTMENTS.forEach(inv => {
        const bought = gameState.purchasedInvestments.includes(inv.id);
        html += `<div class="investment-card">
            <h4>${inv.name} - ¬•${inv.cost.toLocaleString()}</h4>
            <p>${inv.description}</p>
            <button onclick="buyInvestment('${inv.id}')" class="action-btn" ${bought || gameState.money < inv.cost ? 'disabled' : ''}>
                ${bought ? '‚úÖ Kupiono' : 'Kup'}
            </button>
        </div>`;
    });

    container.innerHTML = html;
}

function buyInvestment(id) {
    const inv = SCHOOL_INVESTMENTS.find(i => i.id === id);
    if (!inv || gameState.purchasedInvestments.includes(id) || gameState.money < inv.cost) return;

    gameState.money -= inv.cost;
    gameState.purchasedInvestments.push(id);

    const e = inv.effects;
    if (e.reputation) gameState.reputation += e.reputation;
    if (e.grades) gameState.girls.forEach(g => g.grades = Math.min(100, g.grades + e.grades));
    if (e.morale) gameState.girls.forEach(g => g.morale = Math.min(100, g.morale + e.morale));
    if (e.risk) gameState.risk = Math.max(0, gameState.risk + e.risk);

    logEvent(`üè´ Kupiono: ${inv.name}`, 'school');
    renderSchool();
    updateDashboard();
}

// ============================================================================
// BUSINESS
// ============================================================================

function renderBusiness() {
    const container = document.getElementById('business-operations');
    let html = `<div class="business-section">
        <h3>Ochrona Yakuzy</h3>
        <p><strong>Status:</strong> ${gameState.yakuzaProtection ? '‚úÖ Aktywna' : '‚ùå Nieaktywna'}</p>
        ${gameState.yakuzaProtection ? `
            <p><strong>Podatek:</strong> ${gameState.profitTax}% z dziennych zysk√≥w</p>
            <p><strong>Korzy≈õci:</strong></p>
            <ul>
                <li>Ryzyko -20 (mniej szans na policjƒô i skandale)</li>
                <li>Reputacja +10 (≈Çatwiej rekrutowaƒá)</li>
                <li>Dostƒôp do lepszych event√≥w</li>
            </ul>
        ` : '<p>Czekaj na ofertƒô od Yakuzy w eventach (wymaga ¬•100k+ i 2+ dziewczyn).</p>'}
    </div>

    <div class="business-section">
        <h3>Odblokowane prace</h3>
        <ul>
            ${gameState.unlockedJobs.map(j => `<li><strong>${JOBS_DATA[j].name}</strong>${JOBS_DATA[j].description ? ': ' + JOBS_DATA[j].description : ''}</li>`).join('')}
        </ul>
        <p style="margin-top:15px;color:var(--text-secondary);">Odblokuj wiƒôcej przez wydarzenia i inwestycje.</p>
    </div>`;

    container.innerHTML = html;
}

// ============================================================================
// CITIES
// ============================================================================

function renderCities() {
    const container = document.getElementById('city-locations');
    const cities = [
        { name: 'Tokio', desc: 'Twoja obecna lokacja. Seiran Academy.', yakuza: true, police: '≈õrednia' },
        { name: 'Osaka', desc: 'Drugie miasto. Ta≈Ñsze biznesy, wiƒôcej Yakuzy.', yakuza: true, police: 'niska' },
        { name: 'Kyoto', desc: 'Historyczne miasto. Wysokie wymagania.', yakuza: false, police: 'wysoka' }
    ];

    let html = '<div class="cities-grid">';
    cities.forEach(c => {
        html += `<div class="city-card">
            <h3>${c.name}</h3>
            <p>${c.desc}</p>
            <p><strong>Yakuza:</strong> ${c.yakuza ? '‚úÖ' : '‚ùå'}</p>
            <p><strong>Policja:</strong> ${c.police}</p>
            <p style="margin-top:10px;color:var(--text-secondary);font-size:0.9em;">Ekspansja do innych miast bƒôdzie dostƒôpna w przysz≈Çych wersjach.</p>
        </div>`;
    });
    container.innerHTML = html + '</div>';
}

// ============================================================================
// SAVE/LOAD
// ============================================================================

function saveGame(auto) {
    try {
        localStorage.setItem('gakuen_save', JSON.stringify(gameState));
        if (!auto) alert('‚úÖ Zapisano!');
    } catch(e) { alert('‚ùå B≈ÇƒÖd zapisu!'); }
}

function loadGame() {
    try {
        const saved = localStorage.getItem('gakuen_save');
        if (!saved) { alert('Brak zapisu!'); return; }
        gameState = JSON.parse(saved);
        updateAll();
        alert('‚úÖ Wczytano!');
    } catch(e) { alert('‚ùå B≈ÇƒÖd wczytywania!'); }
}

// ============================================================================
// START
// ============================================================================

document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
